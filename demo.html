<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Mirakl CSV Extension</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .step {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .step h3 {
            color: #0066cc;
            margin-top: 0;
        }
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background: #45a049;
        }
        .button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .csv-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .orders-list {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .order-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 5px 0;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pending { background: #fff3cd; color: #856404; }
        .status.accepted { background: #d4edda; color: #155724; }
        .status.shipped { background: #cce5ff; color: #004085; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõí Demo Mirakl CSV Extension</h1>
        <p>Simulaci√≥n del flujo completo: Mirakl ‚Üí TIPSA</p>
    </div>

    <div class="container">
        <h2>üìã Flujo del MVP</h2>
        <p>Este demo simula todo el proceso que har√≠a la extensi√≥n de Chrome:</p>
        
        <div class="step">
            <h3>1Ô∏è‚É£ Paso 1: Interceptar CSV de Mirakl</h3>
            <p>La extensi√≥n detecta cuando haces clic en "Export CSV" en un marketplace de Mirakl</p>
            <button class="button" onclick="simulateMiraklExport()">üìä Simular Export CSV de Carrefour</button>
            <div id="mirakl-csv" class="csv-preview" style="display: none;"></div>
        </div>

        <div class="step">
            <h3>2Ô∏è‚É£ Paso 2: Procesar y Normalizar</h3>
            <p>La extensi√≥n convierte el CSV de Mirakl al formato est√°ndar OrderStandard</p>
            <div id="orders-list" class="orders-list" style="display: none;">
                <h4>Pedidos Procesados:</h4>
                <div id="orders-content"></div>
            </div>
        </div>

        <div class="step">
            <h3>3Ô∏è‚É£ Paso 3: Generar CSV TIPSA</h3>
            <p>La extensi√≥n convierte los pedidos al formato requerido por TIPSA</p>
            <button class="button" onclick="generateTipsaCSV()" id="tipsa-btn" disabled>üì¶ Generar CSV TIPSA</button>
            <div id="tipsa-csv" class="csv-preview" style="display: none;"></div>
        </div>

        <div class="step">
            <h3>4Ô∏è‚É£ Paso 4: Descargar CSV TIPSA</h3>
            <p>El CSV TIPSA se descarga para que lo subas manualmente a TIPSA</p>
            <button class="button" onclick="downloadTipsaCSV()" id="download-btn" disabled>üíæ Descargar CSV TIPSA</button>
        </div>
    </div>

    <div class="container">
        <h2>üéØ ¬øD√≥nde se env√≠a el CSV?</h2>
        <p><strong>En el MVP:</strong> El CSV TIPSA se descarga a tu ordenador y t√∫ lo subes manualmente a TIPSA</p>
        <p><strong>En la Fase 2:</strong> Se integrar√≠a directamente con la API de TIPSA para env√≠o autom√°tico</p>
        
        <h3>üì§ Proceso Manual Actual:</h3>
        <ol>
            <li>Descargas el CSV TIPSA</li>
            <li>Vas al portal de TIPSA</li>
            <li>Subes el archivo CSV</li>
            <li>TIPSA procesa los env√≠os</li>
        </ol>
    </div>

    <script>
        let processedOrders = [];
        let tipsaCSV = '';

        function simulateMiraklExport() {
            // Simular CSV de Mirakl
            const miraklCSV = `Order ID,Order Date,Status,SKU,Product,Qty,Price,Buyer Name,Buyer Email,Phone,Ship To,Address 1,Address 2,City,Postal Code,Country,Total
ORD-001,2024-01-15,PENDING,SKU-123,Product A,2,25.50,John Doe,john@example.com,+34123456789,John Doe,123 Main St,Apt 4B,Madrid,28001,ES,51.00
ORD-002,2024-01-15,ACCEPTED,SKU-456,Product B,1,45.00,Jane Smith,jane@example.com,+34987654321,Jane Smith,456 Oak Ave,,Barcelona,08001,ES,45.00`;

            document.getElementById('mirakl-csv').innerHTML = miraklCSV.replace(/\n/g, '<br>');
            document.getElementById('mirakl-csv').style.display = 'block';

            // Procesar CSV (simular conversi√≥n a OrderStandard)
            processCSV(miraklCSV);
        }

        function processCSV(csvData) {
            const lines = csvData.split('\n');
            const headers = lines[0].split(',');
            processedOrders = [];

            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',');
                    const order = {
                        orderId: values[0],
                        status: values[2],
                        buyer: values[6],
                        city: values[12],
                        total: values[16]
                    };
                    processedOrders.push(order);
                }
            }

            // Mostrar pedidos procesados
            displayOrders();
        }

        function displayOrders() {
            const ordersContent = document.getElementById('orders-content');
            ordersContent.innerHTML = '';

            processedOrders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.className = 'order-item';
                orderDiv.innerHTML = `
                    <strong>${order.orderId}</strong> - ${order.buyer} (${order.city})
                    <span class="status ${order.status.toLowerCase()}">${order.status}</span>
                    <br><small>Total: ‚Ç¨${order.total}</small>
                `;
                ordersContent.appendChild(orderDiv);
            });

            document.getElementById('orders-list').style.display = 'block';
            document.getElementById('tipsa-btn').disabled = false;
        }

        function generateTipsaCSV() {
            // Generar CSV TIPSA
            tipsaCSV = `destinatario;direccion;cp;poblacion;pais;contacto;telefono;email;referencia;peso;servicio
John Doe;123 Main St, Apt 4B;28001;Madrid;ES;John Doe;+34123456789;john@example.com;ORD-001;1.0;ESTANDAR
Jane Smith;456 Oak Ave;08001;Barcelona;ES;Jane Smith;+34987654321;jane@example.com;ORD-002;0.5;ESTANDAR`;

            document.getElementById('tipsa-csv').innerHTML = tipsaCSV.replace(/\n/g, '<br>');
            document.getElementById('tipsa-csv').style.display = 'block';
            document.getElementById('download-btn').disabled = false;
        }

        function downloadTipsaCSV() {
            const blob = new Blob([tipsaCSV], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'tipsa_orders.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
